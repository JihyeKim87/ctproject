<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>DNA ì—¼ê¸° ì„œì—´ ì¶”ë¡ í•˜ê¸°</title>
  <style>
    body { font-family: 'ë§‘ì€ ê³ ë”•', sans-serif; margin: 30px; background: #f9f9f9;}
    h1 { margin-bottom: 6px; }
    .desc, .rule, .problem, .choices, .settings { margin-bottom: 20px; }
    .box { background: #fff; border: 1.5px solid #aaa; padding: 16px; border-radius: 12px; margin-bottom: 18px;}
    .timer { font-size: 1.18em; font-weight: bold; margin: 8px 0;}
    input[type="text"] { width: 36px; text-align: center; font-size: 1.1em; }
    button { font-size: 1em; padding: 8px 20px; margin-top: 12px;}
    .answer-row { margin-bottom: 8px; }
    .correct { color: #1a8806; font-weight: bold;}
    .wrong { color: #cf2222; font-weight: bold;}
    .hidden { display: none !important;}
    .settings select { margin-right: 14px;}
    #popup {
      display: none;
      position: fixed; top:0; left:0; width:100vw; height:100vh;
      background:rgba(60,60,60,0.35);
      justify-content: center; align-items: center; z-index:99;
    }
    #popup.active { display:flex !important;}
  </style>
</head>
<body>
  <h1>íƒ€ì´í‹€: DNA ì—¼ê¸° ì„œì—´ ì¶”ë¡ í•˜ê¸°</h1>
  <div class="desc"><b>ëŒ€ìƒ ë° êµê³¼:</b> ê³ 1 (í†µí•©ê³¼í•™1)</div>

  <div class="desc box">
    <b>ì§€ë¬¸</b><br>
    ë¹„ë²„ëŠ” ì–´ë–¤ ìƒë¬¼ì˜ DNA ì¡°ê°ì„ ë¶„ì„í•˜ê³  ìˆë‹¤.<br>
    DNAëŠ” ì´ì¤‘ ë‚˜ì„  êµ¬ì¡°ì´ë©°, ê° ì—¼ê¸°ëŠ” ìƒë³´ì ì¸ ì—¼ê¸°ì™€ ê²°í•©í•œë‹¤.
  </div>

  <div class="rule box">
    <b>ê·œì¹™</b><br>
    ì—¼ê¸°ìŒì˜ ê²°í•© ê·œì¹™ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.<br>
    â–¶ <b>ê·œì¹™1:</b> A &harr; T<br>
    â–¶ <b>ê·œì¹™2:</b> G &harr; C
  </div>

  <div class="settings box">
    <b>ê¸°ë³¸ ì •ë³´ ì„¤ì •</b><br>
    ì—¼ê¸°ì„œì—´ì˜ ìˆ˜(ê¸¸ì´) :
    <select id="lenSel">
      <option value="8">8</option>
      <option value="10" selected>10</option>
      <option value="12">12</option>
      <option value="14">14</option>
    </select>
    ì œí•œ ì‹œê°„ :
    <select id="timeSel">
      <option value="30">30ì´ˆ</option>
      <option value="60" selected>1ë¶„</option>
      <option value="90">1ë¶„ 30ì´ˆ</option>
      <option value="120">2ë¶„</option>
    </select>
    <button onclick="startQuiz()">ë¬¸ì œ í’€ê¸°</button>
  </div>

  <div id="quizArea" class="hidden">
    <div class="problem box" id="probBox">
      <b>ë¬¸ì œ</b><br>
      ë¹„ë²„ëŠ” DNA ì´ì¤‘ ê°€ë‹¥ì˜ ì—¼ê¸°ë¥¼ ê´€ì°°í•˜ê³  ê¸°ë¡í•˜ì˜€ìœ¼ë‚˜ ëª‡ ê°œì˜ ì—¼ê¸°ê°€ ê°€ë ¤ì ¸ ìˆì–´ ë³´ì´ì§€ ì•ŠëŠ”ë‹¤.<br>
      ê´€ì°°ëœ ì—¼ê¸° ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë³´ì´ì§€ ì•ŠëŠ” ì—¼ê¸°ë¥¼ ì˜¬ë°”ë¥´ê²Œ ìœ ì¶”í–ˆì„ ë•Œ<br>
      <b>5â€²â†’3â€² ë°©í–¥ì˜ ì „ì²´ ê°€ë‹¥ ì„œì—´ì€ ë¬´ì—‡ì¸ê°€?</b>
    </div>
    <div class="choices box" id="choiceBox"></div>
    <div class="timer" id="timer"></div>
    <form id="ansForm" onsubmit="return checkAnswer();">
      <div id="inputRow" class="answer-row"></div>
      <button type="submit" id="submitBtn">ì •ë‹µ ì œì¶œ</button>
    </form>
    <div id="resultMsg"></div>
  </div>

  <!-- ì¢…ë£Œ íŒì—… -->
  <div id="popup">
    <div style="background:#fff; border-radius:14px; padding:40px 40px 24px 40px; min-width:280px; box-shadow:0 4px 32px rgba(0,0,0,0.16); text-align:center;">
      <div style="font-size:1.4em; margin-bottom:22px;">ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤</div>
      <button onclick="restartQuiz()">ë‹¤ì‹œ ë„ì „</button>
    </div>
  </div>

  <script>
    // ìƒë³´ì  ì—¼ê¸°
    function compBase(x) {
      if(x==='A') return 'T';
      if(x==='T') return 'A';
      if(x==='G') return 'C';
      if(x==='C') return 'G';
      return '?';
    }
    function randomBase() {
      const b = ['A','T','G','C'];
      return b[Math.floor(Math.random()*4)];
    }

    // ì „ì—­ ë³€ìˆ˜
    let answerSeq = [], compSeq = [], questionSeq = [];
    let answerIndex = []; // ê°€ë¦´ ì¸ë±ìŠ¤
    let timer = null, remain = 0, quizLength = 10, quizSeconds = 60;

    // íŒì—… ì œì–´
    function showPopup() {
      document.getElementById('popup').classList.add('active');
    }
    function hidePopup() {
      document.getElementById('popup').classList.remove('active');
    }

    function startQuiz() {
      // ê°’ ì„¤ì •
      quizLength = parseInt(document.getElementById('lenSel').value);
      quizSeconds = parseInt(document.getElementById('timeSel').value);

      // ëœë¤ ì„œì—´ ìƒì„±
      answerSeq = [];
      for(let i=0;i<quizLength;i++) answerSeq.push(randomBase());
      compSeq = answerSeq.map(compBase);

      // ?ë¡œ ê°€ë¦´ ì¸ë±ìŠ¤ (ëœë¤ 2~3ê°œ, ìœ—ì¤„ë§Œ ê°€ë¦°ë‹¤)
      let hideCount = Math.max(2, Math.floor(quizLength/3));
      let idxSet = new Set();
      while(idxSet.size < hideCount) {
        let idx = Math.floor(Math.random()*quizLength);
        if(idx!==0 && idx!==(quizLength-1)) idxSet.add(idx);
      }
      answerIndex = Array.from(idxSet);

      // ë¬¸ì œ ì œì‹œ
      // ìœ—ì¤„ì€ ì¼ë¶€ ?ë¡œ, ì•„ë«ì¤„ì€ ë¬´ì¡°ê±´ ì „ë¶€ ì±„ì›Œì§(ìƒë³´ì  ì—¼ê¸°)
      questionSeq = answerSeq.slice();
      answerIndex.forEach(idx => { questionSeq[idx] = '?'; });

      // ë³´ê¸° ì œì‹œ (ìœ—ì¤„: ì¼ë¶€ ?, ì•„ë«ì¤„: ì „ë¶€ ì±„ì›Œì§)
      let up = questionSeq.join(' ');
      let dn = compSeq.join(' ');
      document.getElementById('choiceBox').innerHTML = `
        <b>ë³´ê¸°</b><br>
        <span style="font-family:Consolas,monospace">5â€²â€“ ${up} â€“3â€²</span><br>
        <span style="font-family:Consolas,monospace">3â€²â€“ ${dn} â€“5â€²</span>
      `;

      // ì…ë ¥ì°½ (ìœ—ì¤„ì—ë§Œ ì…ë ¥ì¹¸, ì•„ë«ì¤„ì€ íŒíŠ¸ë¡œ ëª¨ë‘ ì œê³µ)
      let inputRow = '';
      for(let i=0;i<quizLength;i++) {
        if(answerIndex.includes(i)) {
          inputRow += `<input type="text" maxlength="1" size="1" pattern="[ATGC]" title="A/T/G/C" id="input${i}" autocomplete="off" required> `;
        } else {
          inputRow += `<input type="text" maxlength="1" size="1" disabled style="background:#eee; font-weight:bold" value="${answerSeq[i]}"> `;
        }
      }
      document.getElementById('inputRow').innerHTML = '5â€²â€“ ' + inputRow + 'â€“3â€²';

      // ì˜ì—­ í‘œì‹œ
      document.getElementById('quizArea').classList.remove('hidden');
      document.getElementById('resultMsg').innerText = '';
      document.getElementById('submitBtn').disabled = false;

      // íƒ€ì´ë¨¸ ì„¸íŒ…
      clearInterval(timer);
      remain = quizSeconds;
      document.getElementById('timer').innerText = `ë‚¨ì€ ì‹œê°„: ${remain}ì´ˆ`;
      hidePopup();

      timer = setInterval(() => {
        remain--;
        document.getElementById('timer').innerText = `ë‚¨ì€ ì‹œê°„: ${remain}ì´ˆ`;
        if(remain <= 0) {
          finishQuiz();
        }
      }, 1000);
    }

    // íƒ€ì„ì—… ì²˜ë¦¬
    function finishQuiz() {
      clearInterval(timer);
      document.getElementById('timer').innerText = 'ì‹œê°„ ì¢…ë£Œ!';
      document.getElementById('submitBtn').disabled = true;
      showPopup();
    }

    function restartQuiz() {
      hidePopup();
      startQuiz();
    }

    function checkAnswer() {
      let allCorrect = true;
      answerIndex.forEach(idx=>{
        let userVal = (document.getElementById('input'+idx).value||'').toUpperCase();
        if(userVal !== answerSeq[idx]) allCorrect = false;
      });
      if(allCorrect) {
        document.getElementById('resultMsg').innerHTML = `<span class="correct">ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰</span>`;
        clearInterval(timer);
        document.getElementById('submitBtn').disabled = true;
      } else {
        document.getElementById('resultMsg').innerHTML = `<span class="wrong">ì˜¤ë‹µì…ë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”!</span>`;
      }
      return false; // submit ì°¨ë‹¨
    }

    // ì²« í™”ë©´ì—ì„œëŠ” í€´ì¦ˆ/íŒì—… ë‹¤ ìˆ¨ê¹€
    window.onload = function() {
      document.getElementById('quizArea').classList.add('hidden');
      hidePopup();
      clearInterval(timer);
    };
  </script>
</body>
</html>
